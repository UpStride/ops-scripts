#!/usr/bin/env bash

function usage() {
    echo -e \
"Usage:
  bash compute-audio-space/run -s source_directory -m method
  compute non-variant space from audio files in the source directory.
  Arguments:
   - s: target directory
   - m: compute method [expensive/direct]
  "
}

function copy_file() {
    [ ! -f "$1" ] && return 0
    [ "$1" != "$2" ] && echo -e "-- editing file $1" && mv "$1" "$2"
}

function legit_name() {
  lowercase_name=${1,,}
  clean_name="${lowercase_name//[\ \'\(\)]/_}"
  copy_file "$1" "$clean_name" >/dev/null
}

function info() {
  [ -n "$VERBOSE" ] && echo -e "$1" >&2 || return 0
}

ROOT_DIR=$(dirname "$0")

source "$ROOT_DIR/shared/args.sh"

#Dependencies check
source "$ROOT_DIR/shared/requirements.sh"

#preprocess audio files
source "$ROOT_DIR/shared/preprocess.sh"

#chop audio file to check fractal conservation (method==expensive)
[ "$COMPUTE_METHOD" == "expensive" ] && source "$ROOT_DIR/shared/chop.sh" || true

#Compute FFT of original / reverted / palindromic audio file
source "$ROOT_DIR/shared/compute-3.sh"

[ "$COMPUTE_METHOD" == "expensive" ] && cd "$SOURCE_DIRECTORY" && clear_chopped || true


